{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/LICENSE","path":"vendors/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/README.md","path":"vendors/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/bower.json","path":"vendors/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","path":"vendors/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/bower.json","path":"vendors/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","path":"vendors/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","path":"vendors/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","path":"vendors/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","path":"vendors/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","path":"vendors/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/velocity/bower.json","path":"vendors/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","path":"vendors/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","path":"vendors/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","path":"vendors/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/jquery/index.js","path":"vendors/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","path":"vendors/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","path":"vendors/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","path":"vendors/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","path":"vendors/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","path":"vendors/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","path":"vendors/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","path":"vendors/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","path":"vendors/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","path":"vendors/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","path":"vendors/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","path":"vendors/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","path":"vendors/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","path":"vendors/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","path":"vendors/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","path":"vendors/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","path":"vendors/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","path":"vendors/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","path":"vendors/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","path":"vendors/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","path":"vendors/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.js","path":"vendors/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","path":"vendors/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","path":"vendors/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","path":"vendors/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/landscape/.gitignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1462368434000},{"_id":"themes/landscape/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1462368434000},{"_id":"themes/landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1462368434000},{"_id":"themes/landscape/README.md","hash":"c7e83cfe8f2c724fc9cac32bd71bb5faf9ceeddb","modified":1462368434000},{"_id":"themes/landscape/_config.yml","hash":"fb8c98a0f6ff9f962637f329c22699721854cd73","modified":1462368434000},{"_id":"themes/landscape/package.json","hash":"85358dc34311c6662e841584e206a4679183943f","modified":1462368434000},{"_id":"source/_posts/2016-05-04-spring-security.markdown","hash":"dae1faf2551e0de958d0e4081efeebeec1b3b63c","modified":1462373313000},{"_id":"source/_posts/hello-world.md","hash":"8a02477044e2b77f1b262da2c48c01429e4a32e4","modified":1462368391000},{"_id":"themes/landscape/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1462368434000},{"_id":"themes/landscape/languages/fr.yml","hash":"84ab164b37c6abf625473e9a0c18f6f815dd5fd9","modified":1462368434000},{"_id":"themes/landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1462368434000},{"_id":"themes/landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1462368434000},{"_id":"themes/landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1462368434000},{"_id":"themes/landscape/languages/zh-CN.yml","hash":"ca40697097ab0b3672a80b455d3f4081292d1eed","modified":1462368434000},{"_id":"themes/landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1462368434000},{"_id":"themes/landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1462368434000},{"_id":"themes/landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1462368434000},{"_id":"themes/landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1462368434000},{"_id":"themes/landscape/layout/layout.ejs","hash":"f155824ca6130080bb057fa3e868a743c69c4cf5","modified":1462368434000},{"_id":"themes/landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1462368434000},{"_id":"themes/landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1462368434000},{"_id":"themes/landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1462368434000},{"_id":"themes/landscape/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/after-footer.ejs","hash":"82a30f81c0e8ba4a8af17acd6cc99e93834e4d5e","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/archive.ejs","hash":"931aaaffa0910a48199388ede576184ff15793ee","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/article.ejs","hash":"c4c835615d96a950d51fa2c3b5d64d0596534fed","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/footer.ejs","hash":"93518893cf91287e797ebac543c560e2a63b8d0e","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/head.ejs","hash":"4fe8853e864d192701c03e5cd3a5390287b90612","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/header.ejs","hash":"c21ca56f419d01a9f49c27b6be9f4a98402b2aa3","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1462368434000},{"_id":"themes/landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1462368434000},{"_id":"themes/landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1462368434000},{"_id":"themes/landscape/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":1462368434000},{"_id":"themes/landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1462368434000},{"_id":"themes/landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1462368434000},{"_id":"themes/landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1462368434000},{"_id":"themes/landscape/source/css/_variables.styl","hash":"5e37a6571caf87149af83ac1cc0cdef99f117350","modified":1462368434000},{"_id":"themes/landscape/source/css/style.styl","hash":"a70d9c44dac348d742702f6ba87e5bb3084d65db","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1462368434000},{"_id":"themes/landscape/source/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1462368434000},{"_id":"themes/landscape/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/article.styl","hash":"10685f8787a79f79c9a26c2f943253450c498e3e","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/highlight.styl","hash":"bf4e7be1968dad495b04e83c95eac14c4d0ad7c0","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1462368434000},{"_id":"themes/landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1462368434000},{"_id":"themes/landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1462368434000},{"_id":"themes/landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1462368434000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1462368434000},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1462368434000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1462368434000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1462368434000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1462368434000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1462368434000},{"_id":"themes/landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1462368434000},{"_id":"themes/next/.bowerrc","hash":"80e096fdc1cf912ee85dd9f7e6e77fd40cf60f10","modified":1460085372000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1460085372000},{"_id":"themes/next/.gitignore","hash":"efec790f5b7a0256763e1cc08f12c4f0aff509f6","modified":1460085372000},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1460085372000},{"_id":"themes/next/.javascript_ignore","hash":"d619ee13031908cd72666e4ff652d2ea3483b1c3","modified":1460085372000},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1460085372000},{"_id":"themes/next/README.en.md","hash":"565ba52b3825b85a9f05b41183caca7f18b741d4","modified":1460085372000},{"_id":"themes/next/README.md","hash":"500b5606eb6a09c979d16128f8b00f4bf9bc95ac","modified":1460085372000},{"_id":"themes/next/bower.json","hash":"f89c6700a11d81e067cc97273ca6bf96cb88c8f9","modified":1460085372000},{"_id":"themes/next/_config.yml","hash":"d13c8d8654c48d59ae047613d9ca46e80a4b4d54","modified":1462370199000},{"_id":"themes/next/gulpfile.coffee","hash":"26e5b1b945704c8bc78b928feede895c4c111c95","modified":1460085372000},{"_id":"themes/next/package.json","hash":"63e9c0f1dd9e5d7f51b4ae383981ef939a2ed45d","modified":1460085372000},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"5ab257af816986cd0e53f9527a92d5934ac70ae9","modified":1460085372000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"c2024ded82143807c28a299c5fe6b927ef3525ff","modified":1460085372000},{"_id":"themes/next/languages/de.yml","hash":"786afba25cfc98845a20d9901823ebeebcd1cbbf","modified":1460085372000},{"_id":"themes/next/languages/default.yml","hash":"9db835c0543ade5a89bc80ec5a898203227cf3d8","modified":1460085372000},{"_id":"themes/next/languages/en.yml","hash":"f03799cbdb5a33064ead080bcac4baca1f6bc5f9","modified":1460085372000},{"_id":"themes/next/languages/fr-FR.yml","hash":"1a084623c39de74301f3e92f9388a3a815a542ca","modified":1460085372000},{"_id":"themes/next/languages/ja.yml","hash":"a2c7b6301b5474aab798946fb700289df237c3cf","modified":1460085372000},{"_id":"themes/next/languages/pt.yml","hash":"ca239b39bf65c9462e59d51b12f0fe566d453197","modified":1460085372000},{"_id":"themes/next/languages/ru.yml","hash":"cc7b964a46587aea0e57b0a5269d8fd25570858e","modified":1460085372000},{"_id":"themes/next/languages/zh-Hans.yml","hash":"bea452bc49aed171a210d09bd6cddc4e846ea8ab","modified":1460085372000},{"_id":"themes/next/languages/zh-hk.yml","hash":"519ab3d817ec3bc5bfc91159c494b6b3c170bea7","modified":1460085372000},{"_id":"themes/next/languages/zh-tw.yml","hash":"6b1f345aaefc13e6723dc8a6741b59ac05c20dfd","modified":1460085372000},{"_id":"themes/next/layout/_layout.swig","hash":"993df74467835eeb223d92206f36ecd6cfe5119e","modified":1460085372000},{"_id":"themes/next/layout/archive.swig","hash":"b5b59d70fc1563f482fa07afd435752774ad5981","modified":1460085372000},{"_id":"themes/next/layout/category.swig","hash":"6422d196ceaff4220d54b8af770e7e957f3364ad","modified":1460085372000},{"_id":"themes/next/layout/index.swig","hash":"427d0b95b854e311ae363088ab39a393bf8fdc8b","modified":1460085372000},{"_id":"themes/next/layout/page.swig","hash":"8019d02232a6dd1a665b6a4d2daef8e5dd2f0049","modified":1460085372000},{"_id":"themes/next/layout/post.swig","hash":"e2e512142961ddfe77eba29eaa88f4a2ee43ae18","modified":1460085372000},{"_id":"themes/next/layout/tag.swig","hash":"07cf49c49c39a14dfbe9ce8e7d7eea3d4d0a4911","modified":1460085372000},{"_id":"themes/next/scripts/merge-configs.js","hash":"0c56be2e85c694247cfa327ea6d627b99ca265e8","modified":1460085372000},{"_id":"themes/next/test/.jshintrc","hash":"096ed6df627373edd820f24d46b8baf528dee61d","modified":1460085372000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1460085372000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1460085372000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"43c3433155ccd9abcbe7dce2e6bfa1f3a66af18b","modified":1460085372000},{"_id":"themes/next/layout/_macro/post.swig","hash":"cee85781fe87d98433c994a0571ad7c39a48155b","modified":1460085372000},{"_id":"themes/next/layout/_macro/reward.swig","hash":"70bd1f11a558a7fc4b8fd7860377f31e0357ceb6","modified":1460085372000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"6609240fe73a53e436d0c8302279e28596dc9c70","modified":1460085372000},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"85327c2174d09c6d69c9033592e6c8f7eb7ac3ba","modified":1460085372000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"82a9bc2ba60ce68419128ff60624bd74b15dfb78","modified":1460085372000},{"_id":"themes/next/layout/_partials/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1460085372000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"3003fda5a8af553451f7945f4e1ce006ca72e4c4","modified":1460085372000},{"_id":"themes/next/layout/_partials/head.swig","hash":"53bf077755e217a2b5ae107da62b6a824a0baa52","modified":1460085372000},{"_id":"themes/next/layout/_partials/header.swig","hash":"7739068b69f87ae641dea19c3445169ae80d5df4","modified":1460085372000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1460085372000},{"_id":"themes/next/layout/_partials/search.swig","hash":"011b9d6c9f0a2f4654908ea20b9391f9b7981271","modified":1460085372000},{"_id":"themes/next/layout/_scripts/baidu-push.swig","hash":"82d060fe055d6e423bbc9199f82dfe5c68e74779","modified":1460085372000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1460085372000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1460085372000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"0b91cadecead8e0b5211cc42b085998d94af503a","modified":1460085372000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1460085372000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"3acce36db0feb11a982c6c799aa6b6b47df2827c","modified":1460085372000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1460085372000},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1460085372000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1460085372000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1460085372000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1460085372000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1460085372000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1460085372000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1460085372000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1460085372000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1460085372000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1460085372000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1460085372000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1460085372000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1460085372000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1460085372000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"9c853c10ab79a3940aa3c0affe0badb881d5e890","modified":1460085372000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"ff5523d5dacaa77a55a24e50e6e6530c3b98bfad","modified":1460085372000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1460085372000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1460085372000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"c07f7b2f264e5215b8ed42d67e8cef2477558364","modified":1460085372000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"7ca5cb4daa58b3504e17f3e02975e794bc634658","modified":1460085372000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1460085372000},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"63315fcf210799f894208c9f512737096df84962","modified":1460085372000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1460085372000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/analytics.swig","hash":"0a89c04055bade7baa5962f1d5aefe438d83a244","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/comments.swig","hash":"907b931d775d32405d02a25b3b0a3ac03bf804d0","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/lean-analytics.swig","hash":"2fc4a0d2c825a512f39c0eadd78452e90615465a","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/localsearch.swig","hash":"1561bd0c107d725252c6d746e9ac177fc18f93bf","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/mathjax.swig","hash":"5bafc33f57508d1d04a9930165240f6e9efa8d6d","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1460085372000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1460085372000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"c8d35a6b9e3bff6d8fdb66de853065af9d37562d","modified":1460085372000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"11d443fc97648d2965d7f8bad9f4a493996fe62f","modified":1460085372000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"2676996e819af2079c552f755ab7933939e151cd","modified":1460085372000},{"_id":"themes/next/source/css/_variables/default.styl","hash":"8ec3307fe42d738b1bbda4b6419d0995f5560222","modified":1460085372000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1460085372000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"4e49707c99c8bbcfa0a607dfdaff0fbb7dffd2a3","modified":1460085372000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"39bf93769d9080fa01a9a875183b43198f79bc19","modified":1460085372000},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1460085372000},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1460085372000},{"_id":"themes/next/source/js/src/motion.js","hash":"269414e84df544a4ccb88519f6abae4943db3c67","modified":1460085372000},{"_id":"themes/next/source/js/src/post-details.js","hash":"10247c78fe933a0cfcaad22a2a03e7a026864461","modified":1460085372000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1460085372000},{"_id":"themes/next/source/js/src/utils.js","hash":"a3a3375de818964f4cbed4d0e2c2f97ccee7199e","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/.bower.json","hash":"cc40a9b11e52348e554c84e4a5c058056f6b7aeb","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/.gitattributes","hash":"2db21acfbd457452462f71cc4048a943ee61b8e0","modified":1460085372000},{"_id":"themes/next/source/vendors/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1460085372000},{"_id":"themes/next/source/vendors/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1460085372000},{"_id":"themes/next/source/vendors/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1460085372000},{"_id":"themes/next/source/vendors/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/.bower.json","hash":"7da985a99674e54f514d4fd9fcd3bcea6e7e41d5","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","hash":"69a4c537d167b68a0ccf1c6febd138aeffca60d6","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1460085372000},{"_id":"themes/next/source/vendors/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1460085372000},{"_id":"themes/next/source/vendors/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1460085372000},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1460085372000},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1460085372000},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1460085372000},{"_id":"themes/next/source/vendors/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/analytics/baidu-analytics.swig","hash":"7c43d66da93cde65b473a7d6db2a86f9a42647d6","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/analytics/cnzz-analytics.swig","hash":"44e761721e8ad787ef571a3cc57bbc12d318a2a3","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/analytics/facebook-sdk.swig","hash":"334176d838ee528e58468d8bc74ff3a6d3f25b2b","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/analytics/google-analytics.swig","hash":"30a23fa7e816496fdec0e932aa42e2d13098a9c2","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/comments/disqus.swig","hash":"3491d3cebabc8a28857200db28a1be65aad6adc2","modified":1460085372000},{"_id":"themes/next/layout/_scripts/third-party/comments/duoshuo.swig","hash":"8c7af79407d223486fba72b8150fe045a553bf70","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"10994990d6e0b4d965a728a22cf7f6ee29cae9f6","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"b49efc66bd055a2d0be7deabfcb02ee72a9a28c8","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"0dfb4b3ba3180d7285e66f270e1d3fa0f132c3d2","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"711c8830886619d4f4a0598b0cde5499dce50c62","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1460085372000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"5304f99581da3a31de3ecec959b7adf9002fde83","modified":1460085372000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"4c84903d6a15a903235eec04a560fdeda80c12f3","modified":1460085372000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1460085372000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"013619c472c7e4b08311c464fcbe9fcf5edde603","modified":1460085372000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"04e6c5257814c65e638ab70c53030e8dfdb3f37d","modified":1460085372000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"4303776991ef28f5742ca51c7dffe6f12f0acf34","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"6cc10d943d92eac953e6978e46d27ae55584482c","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"6ed60cc621bac096c0ed7534fa25b1a52dc571d4","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"c2c6c4f6434b4f94aac2af5861cd769427f0ee10","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"8aca5d9f1df157ab27e699c1b3ba9438b9e039ad","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"be22ad34f546a07f6d56b424338cdd898683eea4","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"8d7cecde4933900c7df2db9d0a98f5f82f88dc93","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/_full-image.styl","hash":"938d39eedc6e3d33918c1145a5bf1e79991d3fcf","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"d09280e5b79f3b573edb30f30c7a5f03ac640986","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"cd2acd8c415c552e397af2da61d7659688e7aab4","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"1b10ba2d3ad0c063c418dc94a0b7e0db4b342c53","modified":1460085372000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"7506e7490c69a200831393c38d25e91c156bd471","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1460085372000},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1460085372000},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","hash":"3b87c2560832748cd06f9bfd2fd6ea8edbdae8c7","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","hash":"05ea25bc9b3ac48993e1fee322d3bc94b49a6e22","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","hash":"574ea2698c03ae9477db2ea3baf460ee32f1a7ea","modified":1460085372000},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1460085372000},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","hash":"0112e96f327d413938d37c1693806f468ffdbace","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","hash":"b3c2f08e73320135b69c23a3908b87a12053a2f6","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","hash":"507970402e328b2baeb05bde73bf9ded4e2c3a2d","modified":1460085372000},{"_id":"themes/next/source/vendors/velocity/velocity.js","hash":"e63dc7cea055ca60a95d286f32349d88b10c5a4d","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"8994ffcce84deac0471532f270f97c44fea54dc0","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"e340071ee392f55b32c540d690198f157e588433","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"90f8f9706cd7fe829cf06e9959a65fd3f8b994fa","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"c890ce7fe933abad7baf39764a01894924854e92","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"23dd966324937deeccc8f5fa16a6d32e4e46243b","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"3c46efd6601e268093ce6d7b1471d18501878f0d","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"8c0661a7ca4be8768324f62396a21e75560b4ce1","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"b25132fe6a7ad67059a2c3afc60feabb479bdd75","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"d543d1377c1f61b70e3adb6da0eb12797552e5f2","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-more-link.styl","hash":"15063d79b5befc21820baf05d6f20cc1c1787477","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"cbca4842a54950e2934b3b8f3cd940f122111aef","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"99d994bd19895a4aaa2fa8d12801ec72dd3cf118","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"d4303e6439e70dc23f9151c69bc31a7fb0ece820","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"2e7ec9aaa3293941106b1bdd09055246aa3c3dc6","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"89fef1caf94caf76ca09c643b83b0b4d4e417e08","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"c44f6a553ec7ea5508f2054a13be33a62a15d3a9","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"7690b9596ec3a49befbe529a5a2649abec0faf76","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"2d3abbc85b979a648e0e579e45f16a6eba49d1e7","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"234facd038f144bd0fe09a31ed1357c5d74c517f","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"58fb7604b44e3f56d880bbbd95d0baface38c4ee","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"618f73450cf541f88a4fddc3d22898aee49d105d","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"8e66c2635d48e11de616bb29c4b1323698eebc0a","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"795d94561888d31cb7a6ff4a125596809ea69b7d","modified":1460085372000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"f7ebd428f3058ec3ecc7648788712617bea520ba","modified":1460085372000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1460085372000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","hash":"27cf1f2ec59aece6938c7bb2feb0e287ea778ff9","modified":1460085372000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","hash":"2b3c8ba7008cc014d8fb37abc6f9f49aeda83824","modified":1460085372000},{"_id":"themes/next/._config.yml.swp","hash":"a86fb959e0dafc0fc54a2ad017c93e1695bee5a1","modified":1462374229000},{"_id":"source/_posts/.2016-05-04-spring-security.markdown.swp","hash":"c3f9ab7ed3cf271cd04f78868d0e60808d5d9cbf","modified":1462373320000},{"_id":"source/tags/index.md","hash":"2f92f8ad31dca9d4122a58ca2e2e4d890dcbba48","modified":1462374141000}],"Category":[],"Data":[],"Page":[{"title":"tags","date":"2016-05-04T15:01:34.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-05-04 23:01:34\ntype: \"tags\"\n---\n","updated":"2016-05-04T15:02:21.000Z","path":"tags/index.html","_id":"cinszs271000024pyzcwmoln6","comments":1,"layout":"page","content":"","excerpt":"","more":""}],"Post":[{"title":"spring security","layout":"post","_content":"\n# spring security\n\n### 背景知识\n什么是spring security.官方解释:\n>Spring Security provides comprehensive security services for Java EE-based enterprise software applications.   \n\n简单的说就是给应用提供安全服务的.那安全服务要解决哪里问题呢?  \n我认为主要要解决这两个问题:\n\n* 你是谁? (authentication,身份验证)\n* 你能干什么? (authorization,访问控制)\n\n对应到spring security中两个重要的概念`authentication`和`authorization`\n\n### Hello World\n在一个使用spring框架的web应用中增加spring security的最简功能是非常之简单的.  \n第一步:在pom.xml中增加相应的依赖,这里以4.0.3为例.\n\n```xml\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-web</artifactId>\n    <version>4.0.3.RELEASE</version>\n</dependency>\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-config</artifactId>\n    <version>4.0.3.RELEASE</version>\n</dependency>\n```\n\n第二步:在web.xml中配置filter,需要注意的是这个配置中的`springSecurityFilterChain`这个名称是不能随意自定义的,后面我们会再解释原因.\n\n```xml\n<filter>\n    <filter-name>springSecurityFilterChain</filter-name>\n    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>\n</filter>\n<filter-mapping>\n    <filter-name>springSecurityFilterChain</filter-name>\n    <url-pattern>/*</url-pattern>\n</filter-mapping>\n```\n\n第三步:编写一个最简单的security配置,并import到已有的spring配置文件中.\n\n```xml\n<b:beans xmlns=\"http://www.springframework.org/schema/security\"\n    xmlns:b=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd\">\n\n    <http>\n        <intercept-url pattern=\"/**\" access=\"hasRole('USER')\" />\n        <form-login />\n        <logout />\n    </http>\n\n    <authentication-manager>\n        <authentication-provider>\n            <user-service>\n                <user name=\"admin\" password=\"password\" authorities=\"ROLE_USER\" />\n            </user-service>\n        </authentication-provider>\n    </authentication-manager>\n</b:beans>\n```\n\n经过这三步配置,最简单的spring security的集成已经完成了.现在可以访问你的应用试试.用户名:admin,密码:passowrd\n\n### 初窥\n那spring security又是怎么工作的呢?  \n这一切都得从web.xml的filter配置说起.可以spring security配置的filter是`org.springframework.web.filter.DelegatingFilterProxy`这是什么东东啊?看看这个类的javadoc解释就能明白:\n>Proxy for a standard Servlet Filter, delegating to a Spring-managed bean that implements the Filter interface. \n\n这就是一个简单的代理类,代理spring container中实现了servlet filter的类,那如果很多实现了filter类该怎么找到想要的那个呢?通过`<filter-name>`中定义的名称.所以上面的web.xml配置中我提到了这个名称不能随意修改.而真正的spring security使用的filter是`org.springframework.security.filterChainProxy`.知道了入口就好办了,我们再接着分析这个filter chain中有哪些核心的filter.\n\n### 核心对象\n\nSecurityContextHolder是spring security中最基本的对象,用于存储当前用户的所有安全相关的信息.默认使用ThreadLocal,也可以用`SecurityContextHolder`修改策略.大部分情况下是不需要修改的.这个类最常用的功能就是获取当前用户的信息,以下是官方提供的例子:\n\n```java\nObject principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();\n\nif (principal instanceof UserDetails) {\n  String username = ((UserDetails)principal).getUsername();\n} else {\n  String username = principal.toString();\n}\n```\n\norg.springframework.security.core.Authentication这个接口类也比较重要,里面存放了用户名,密码,以及用户拥有的权限列表.下面是官方的解释:\n\n- SecurityContextHolder, to provide access to the SecurityContext.\n- SecurityContext, to hold the Authentication and possibly request-specific security information.\n- Authentication, to represent the principal in a Spring Security-specific manner.\n- GrantedAuthority, to reflect the application-wide permissions granted to a principal.\n- UserDetails, to provide the necessary information to build an Authentication object from your application’s DAOs or other source of security data.\n- UserDetailsService, to create a UserDetails when passed in a String-based username (or certificate ID or the like).\n\n### 身份验证(Authentication)\n一般web应用的步骤都是:\n\n1. 用传入的用户名和密码生成UsernamePasswordAuthenticationToken\n2. 传入AuthenticationManager的实现类做校验\n3. 如果验证通过返回一个完整的Authentication\n4. 用SecurityContextHolder.getContext().setAuthentication()方法存入context\n\n简化版的代码实现:\n\n```java\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.BadCredentialsException;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.AuthenticationException;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.context.SecurityContextHolder;\n\npublic class AuthenticationExample {\n\n    private static AuthenticationManager am = new SampleAuthenticationManager();\n\n    //正确的用户名:admin,密码:1234\n    public static void main(String[] args) throws Exception {\n        BufferedReader in = new BufferedReader(new InputStreamReader(System.in));\n\n        while (true) {\n            System.out.println(\"Please enter your username:\");\n            String name = in.readLine();\n            System.out.println(\"Please enter your password:\");\n            String password = in.readLine();\n            try {\n                Authentication request = new UsernamePasswordAuthenticationToken(name, password);\n                Authentication result = am.authenticate(request);\n                SecurityContextHolder.getContext().setAuthentication(result);\n                break;\n            } catch (AuthenticationException e) {\n                System.out.println(\"Authentication failed: \" + e.getMessage());\n            }\n        }\n        System.out.println(\"Successfully authenticated. Security context contains: \"\n                           + SecurityContextHolder.getContext().getAuthentication());\n    }\n}\n\nclass SampleAuthenticationManager implements AuthenticationManager {\n    static final List<GrantedAuthority> AUTHORITIES = new ArrayList<GrantedAuthority>();\n\n    static {\n        AUTHORITIES.add(new SimpleGrantedAuthority(\"ROLE_USER\"));\n    }\n\n    public Authentication authenticate(Authentication auth) throws AuthenticationException {\n        if (\"admin\".equals(auth.getName()) && \"1234\".equals(auth.getCredentials())) {\n            return new UsernamePasswordAuthenticationToken(auth.getName(), auth.getCredentials(), AUTHORITIES);\n        }\n        throw new BadCredentialsException(\"Bad Credentials\");\n    }\n}\n```\n\n还可以直接向context中塞入Authentication\n\n>In fact, Spring Security doesn’t mind how you put the Authentication object inside the SecurityContextHolder. The only critical requirement is that the SecurityContextHolder contains an Authentication which represents a principal before the `AbstractSecurityInterceptor` (which we’ll see more about later) needs to authorize a user operation.\n\n### 访问控制(Authorization)\nAccessDecisionManager来决定一个用户(Authentication)能否访问特定的资源(web应用中一般是url)\n\nAbstractSecurityInterceptor的鉴权步骤:\n\n1. Look up the \"configuration attributes\" associated with the present request\n2. Submitting the secure object, current Authentication and configuration attributes to the AccessDecisionManager for an authorization decision\n3. Optionally change the Authentication under which the invocation takes place\n4. Allow the secure object invocation to proceed (assuming access was granted)\n5. Call the AfterInvocationManager if configured, once the invocation has returned. If the invocation raised an exception, the AfterInvocationManager will not be invoked.\n\nconfiguration attributes指的是配置文件中的这些配置\n\n```xml\n<intercept-url pattern=\"/imageBridge/**\" access=\"permitAll\" /> \n<intercept-url pattern=\"/system/getStartInfo.htm\" access=\"permitAll\" /> \n<intercept-url pattern=\"/**/*.htm\" access=\"hasRole('ADMIN')\" />\n```\n\n### 核心组件\nAuthenticationManager顾名思义就是Authentication的管理器\n在spring security中的默认实现是ProviderManager这个类的作用就是串联起一系列的AuthenticationProvider,每个Provider都会对用户进行身份验证.如果成功就返回Authentication,失败的话就抛出异常\nAuthenticationProvider的定义:\n\n```java\npublic interface AuthenticationProvider {\n    Authentication authenticate(Authentication authentication)throws AuthenticationException;\n    boolean supports(Class<?> authentication);\n```\n\nUserDetailsService用于根据username获取UserDetails对象.很多默认的Provider都需要注入UserDetailsService,当然如果是自己实现的Provider就可以不需要实现UserDetailsService\n\n### 使用\n从上面的介绍中可以看出,spring security最重要的两大特性就是身份验证和访问控制.而且可以很灵活的单独使用访问控制.下面我们来介绍几种常见的使用方法.\n##### 1.自定义UserDetailsService\n\n这个是简化版本的UserDetailsService的实现.当然现实情况中可能会从数据库中加载user信息.\n这里使用的是默认的DaoAuthenticationProvider\n\n```java\npublic class MyUserDetailsService implements UserDetailsService {\n\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        List<GrantedAuthority> grantedAuthorities = new ArrayList<GrantedAuthority>();\n        grantedAuthorities.add(new SimpleGrantedAuthority(\"ROLE_GUEST\"));\n\n        // 如果用户为admin,则分配两个权限\n        if (\"admin\".equals(username)) {\n            grantedAuthorities.add(new SimpleGrantedAuthority(\"ROLE_ADMIN\"));\n        }\n        User user = new User(username, \"password\", true, true, true, true, grantedAuthorities);\n        return user;\n    }\n\n}\n```\nspring security的配置\n\n```xml\n<http>\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    <form-login />\n    <logout />\n</http>\n\n<authentication-manager>\n    <authentication-provider user-service-ref=\"myUserDetailsService\">\n    </authentication-provider>\n</authentication-manager>\n\n<b:bean id=\"myUserDetailsService\" class=\"name.chengchao.springsecurity.framework.MyUserDetailsService\"></b:bean>\n```\n\n##### 2.自定义Provider\n\n```java\npublic class MyAuthenticationProvider implements AuthenticationProvider {\n\n    private static Logger logger = LoggerFactory.getLogger(MyAuthenticationProvider.class);\n\n    public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n        String username = authentication.getName();\n        String password = authentication.getCredentials().toString();\n        if (!\"password\".equals(password)) {\n            throw new BadCredentialsException(\"password error,username:\" + username);\n        }\n        logger.info(\"username:{},login!\", username);\n        List<GrantedAuthority> grantedAuths = new ArrayList<GrantedAuthority>();\n        grantedAuths.add(new SimpleGrantedAuthority(\"ROLE_GUEST\"));\n        if (\"admin\".equals(username)) {\n            grantedAuths.add(new SimpleGrantedAuthority(\"ROLE_ADMIN\"));\n        }\n        return new UsernamePasswordAuthenticationToken(username, password, grantedAuths);\n    }\n\n    public boolean supports(Class<?> authentication) {\n        return authentication.equals(UsernamePasswordAuthenticationToken.class);\n    }\n\n}\n```\nspring security的配置\n\n```xml\n<http>\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    <form-login />\n    <logout />\n</http>\n\n<authentication-manager>\n    <authentication-provider ref=\"myAuthenticationProvider\">\n    </authentication-provider>\n</authentication-manager>\n\n<b:bean id=\"myAuthenticationProvider\" class=\"name.chengchao.springsecurity.framework.MyAuthenticationProvider\"></b:bean>\n```\n\n这样就不需要再用到userdetailsService\n\n\n##### 3.自定义Filter\n记得前面说过,spring只关心在AbstractSecurityInterceptor之前,contextHolder中有Authentication信息就行了,至于怎么放进去的是不关心的.  \n有很多时候,我们的系统需要和已有的统一登录(单点登录)系统对接.这就需要自定义一个filter来完成这个对接.\n\n```java\npublic class MySecurityFilter extends GenericFilterBean {\n\n    public Logger logger = LoggerFactory.getLogger(MySecurityFilter.class);\n\n    @Override\n    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException,\n                                                                                      ServletException {\n\n        HttpServletRequest request = (HttpServletRequest) req;\n        HttpServletResponse response = (HttpServletResponse) resp;\n\n        // 这里的user一般来自于统一登录系统\n        User user = new User(\"admin\");\n        // 再从数据库或者ACL系统查询该用户拥有的权限\n\n        logger.info(\"welcome,{}\", user.getName());\n\n        List<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();\n        authorities.add(new SimpleGrantedAuthority(\"ROLE_GUEST\"));\n        authorities.add(new SimpleGrantedAuthority(\"ROLE_ADMIN\"));\n        Authentication authentication = new UsernamePasswordAuthenticationToken(user.getName(), user.getName(),\n                                                                                authorities);\n        SecurityContextHolder.getContext().setAuthentication(authentication);\n        chain.doFilter(request, response);\n    }\n\n    class User {\n\n        private String name;\n\n        public User(String name){\n            super();\n            this.name = name;\n        }\n\n        public String getName() {\n            return name;\n        }\n\n    }\n\n}\n```\nspring security的配置\n\n```xml\n<http entry-point-ref=\"myAuthenticationEntryPoint\">\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    <!-- <form-login /> -->\n    <custom-filter ref=\"mySecurityFilter\" before=\"FILTER_SECURITY_INTERCEPTOR\" />\n    <logout />\n</http>\n\n<!-- 自定义的filter -->\n<b:bean id=\"mySecurityFilter\"\n    class=\"name.chengchao.springsecurity.framework.MySecurityFilter\"></b:bean>\n\n<!-- 定义一个空的entryPoint -->\n<b:bean id=\"myAuthenticationEntryPoint\"\n    class=\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"></b:bean>\n\n<authentication-manager></authentication-manager>\n\n```\n\n至此3中比较常见的用法都已经介绍完毕.在自定义的filter中会对每个请求都会做用户信息的查询.这里可以使用cache提高性能.在集群环境中,可以把用户信息放入用户浏览器的cookie中.用来保证不同机器之间的访问只需要登录一次.最后介绍一下权限的动态校验.因为以上举的例子都是静态化的配置.但在真实项目中对权限配置的需求往往是需要动态的(数据库).下面就来介绍一下如何在spring security中使用动态化的配置.  \n\n在开始之前,先要了解一下org.springframework.security.access.AccessDecisionManager.这个接口用来访问控制.\n\n```java\n/**\n     * Resolves an access control decision for the passed parameters.\n     *\n     * @param authentication the caller invoking the method (not null)\n     * @param object the secured object being called\n     * @param configAttributes the configuration attributes associated with the secured\n     * object being invoked\n     *\n     * @throws AccessDeniedException if access is denied as the authentication does not\n     * hold a required authority or ACL privilege\n     * @throws InsufficientAuthenticationException if access is denied as the\n     * authentication does not provide a sufficient level of trust\n     */\n    void decide(Authentication authentication, Object object,\n            Collection<ConfigAttribute> configAttributes) throws AccessDeniedException,\n            InsufficientAuthenticationException;\n```\n\n这个方法有三个参数:\n\n- Authentication:是谁,以及有什么角色\n- object:要访问的资源\n- configAttributes:访问控制策略的配置,如果在数据库中,这个参数可以忽略\n\n在来看看AbstractAccessDecisionManager有三个实现:\n\n- AffirmativeBased: 只要有一个同意就行\n- ConsensusBased: 少数服从多数\n- UnanimousBased: 全体一致同意\n\n可以根据自己的需要进行选择.下面的例子比较简单,用的是ConsensusBased\n\n```java\npublic class MyVoter implements AccessDecisionVoter<FilterInvocation> {\n\n    @Override\n    public int vote(Authentication authentication, FilterInvocation fi, Collection<ConfigAttribute> attributes) {\n        // FilterInvocation: URL: /admin.do 表示请求的资源\n        // Authentication: 表示用户以及他拥有的权限\n        // 根据数据库中的配置来决定\n        // 可以参考org.springframework.security.web.access.expression.WebExpressionVoter\n        return ACCESS_GRANTED;\n    }\n\n    @Override\n    public boolean supports(ConfigAttribute attribute) {\n        return true;\n    }\n\n    @Override\n    public boolean supports(Class<?> clazz) {\n        return true;\n    }\n\n}\n```\n\n\nspring security的配置\n\n```xml\n<http entry-point-ref=\"myAuthenticationEntryPoint\"\n    access-decision-manager-ref=\"accessDecisionManager\">\n    <!-- 从数据库读取\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    -->\n    <custom-filter ref=\"mySecurityFilter\" before=\"FILTER_SECURITY_INTERCEPTOR\" />\n    <logout />\n</http>\n\n<!-- 自定义的filter -->\n<b:bean id=\"mySecurityFilter\"\n    class=\"name.chengchao.springsecurity.framework.MySecurityFilter\"></b:bean>\n\n<!-- 定义一个空的entryPoint -->\n<b:bean id=\"myAuthenticationEntryPoint\"\n    class=\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"></b:bean>\n\n<authentication-manager></authentication-manager>\n\n\n<b:bean id=\"myVoter\" class=\"name.chengchao.springsecurity.framework.MyVoter\">\n</b:bean>\n\n<b:bean id=\"accessDecisionManager\"\n    class=\"org.springframework.security.access.vote.ConsensusBased\">\n    <b:constructor-arg ref=\"myVoter\"></b:constructor-arg>\n</b:bean>\n```\n","source":"_posts/2016-05-04-spring-security.markdown","raw":"---\ntitle: spring security\nlayout: post\ntags:\n  - java\n  - tech\n  - spring\n  \n---\n\n# spring security\n\n### 背景知识\n什么是spring security.官方解释:\n>Spring Security provides comprehensive security services for Java EE-based enterprise software applications.   \n\n简单的说就是给应用提供安全服务的.那安全服务要解决哪里问题呢?  \n我认为主要要解决这两个问题:\n\n* 你是谁? (authentication,身份验证)\n* 你能干什么? (authorization,访问控制)\n\n对应到spring security中两个重要的概念`authentication`和`authorization`\n\n### Hello World\n在一个使用spring框架的web应用中增加spring security的最简功能是非常之简单的.  \n第一步:在pom.xml中增加相应的依赖,这里以4.0.3为例.\n\n```xml\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-web</artifactId>\n    <version>4.0.3.RELEASE</version>\n</dependency>\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-config</artifactId>\n    <version>4.0.3.RELEASE</version>\n</dependency>\n```\n\n第二步:在web.xml中配置filter,需要注意的是这个配置中的`springSecurityFilterChain`这个名称是不能随意自定义的,后面我们会再解释原因.\n\n```xml\n<filter>\n    <filter-name>springSecurityFilterChain</filter-name>\n    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>\n</filter>\n<filter-mapping>\n    <filter-name>springSecurityFilterChain</filter-name>\n    <url-pattern>/*</url-pattern>\n</filter-mapping>\n```\n\n第三步:编写一个最简单的security配置,并import到已有的spring配置文件中.\n\n```xml\n<b:beans xmlns=\"http://www.springframework.org/schema/security\"\n    xmlns:b=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd\">\n\n    <http>\n        <intercept-url pattern=\"/**\" access=\"hasRole('USER')\" />\n        <form-login />\n        <logout />\n    </http>\n\n    <authentication-manager>\n        <authentication-provider>\n            <user-service>\n                <user name=\"admin\" password=\"password\" authorities=\"ROLE_USER\" />\n            </user-service>\n        </authentication-provider>\n    </authentication-manager>\n</b:beans>\n```\n\n经过这三步配置,最简单的spring security的集成已经完成了.现在可以访问你的应用试试.用户名:admin,密码:passowrd\n\n### 初窥\n那spring security又是怎么工作的呢?  \n这一切都得从web.xml的filter配置说起.可以spring security配置的filter是`org.springframework.web.filter.DelegatingFilterProxy`这是什么东东啊?看看这个类的javadoc解释就能明白:\n>Proxy for a standard Servlet Filter, delegating to a Spring-managed bean that implements the Filter interface. \n\n这就是一个简单的代理类,代理spring container中实现了servlet filter的类,那如果很多实现了filter类该怎么找到想要的那个呢?通过`<filter-name>`中定义的名称.所以上面的web.xml配置中我提到了这个名称不能随意修改.而真正的spring security使用的filter是`org.springframework.security.filterChainProxy`.知道了入口就好办了,我们再接着分析这个filter chain中有哪些核心的filter.\n\n### 核心对象\n\nSecurityContextHolder是spring security中最基本的对象,用于存储当前用户的所有安全相关的信息.默认使用ThreadLocal,也可以用`SecurityContextHolder`修改策略.大部分情况下是不需要修改的.这个类最常用的功能就是获取当前用户的信息,以下是官方提供的例子:\n\n```java\nObject principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();\n\nif (principal instanceof UserDetails) {\n  String username = ((UserDetails)principal).getUsername();\n} else {\n  String username = principal.toString();\n}\n```\n\norg.springframework.security.core.Authentication这个接口类也比较重要,里面存放了用户名,密码,以及用户拥有的权限列表.下面是官方的解释:\n\n- SecurityContextHolder, to provide access to the SecurityContext.\n- SecurityContext, to hold the Authentication and possibly request-specific security information.\n- Authentication, to represent the principal in a Spring Security-specific manner.\n- GrantedAuthority, to reflect the application-wide permissions granted to a principal.\n- UserDetails, to provide the necessary information to build an Authentication object from your application’s DAOs or other source of security data.\n- UserDetailsService, to create a UserDetails when passed in a String-based username (or certificate ID or the like).\n\n### 身份验证(Authentication)\n一般web应用的步骤都是:\n\n1. 用传入的用户名和密码生成UsernamePasswordAuthenticationToken\n2. 传入AuthenticationManager的实现类做校验\n3. 如果验证通过返回一个完整的Authentication\n4. 用SecurityContextHolder.getContext().setAuthentication()方法存入context\n\n简化版的代码实现:\n\n```java\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.BadCredentialsException;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.AuthenticationException;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.context.SecurityContextHolder;\n\npublic class AuthenticationExample {\n\n    private static AuthenticationManager am = new SampleAuthenticationManager();\n\n    //正确的用户名:admin,密码:1234\n    public static void main(String[] args) throws Exception {\n        BufferedReader in = new BufferedReader(new InputStreamReader(System.in));\n\n        while (true) {\n            System.out.println(\"Please enter your username:\");\n            String name = in.readLine();\n            System.out.println(\"Please enter your password:\");\n            String password = in.readLine();\n            try {\n                Authentication request = new UsernamePasswordAuthenticationToken(name, password);\n                Authentication result = am.authenticate(request);\n                SecurityContextHolder.getContext().setAuthentication(result);\n                break;\n            } catch (AuthenticationException e) {\n                System.out.println(\"Authentication failed: \" + e.getMessage());\n            }\n        }\n        System.out.println(\"Successfully authenticated. Security context contains: \"\n                           + SecurityContextHolder.getContext().getAuthentication());\n    }\n}\n\nclass SampleAuthenticationManager implements AuthenticationManager {\n    static final List<GrantedAuthority> AUTHORITIES = new ArrayList<GrantedAuthority>();\n\n    static {\n        AUTHORITIES.add(new SimpleGrantedAuthority(\"ROLE_USER\"));\n    }\n\n    public Authentication authenticate(Authentication auth) throws AuthenticationException {\n        if (\"admin\".equals(auth.getName()) && \"1234\".equals(auth.getCredentials())) {\n            return new UsernamePasswordAuthenticationToken(auth.getName(), auth.getCredentials(), AUTHORITIES);\n        }\n        throw new BadCredentialsException(\"Bad Credentials\");\n    }\n}\n```\n\n还可以直接向context中塞入Authentication\n\n>In fact, Spring Security doesn’t mind how you put the Authentication object inside the SecurityContextHolder. The only critical requirement is that the SecurityContextHolder contains an Authentication which represents a principal before the `AbstractSecurityInterceptor` (which we’ll see more about later) needs to authorize a user operation.\n\n### 访问控制(Authorization)\nAccessDecisionManager来决定一个用户(Authentication)能否访问特定的资源(web应用中一般是url)\n\nAbstractSecurityInterceptor的鉴权步骤:\n\n1. Look up the \"configuration attributes\" associated with the present request\n2. Submitting the secure object, current Authentication and configuration attributes to the AccessDecisionManager for an authorization decision\n3. Optionally change the Authentication under which the invocation takes place\n4. Allow the secure object invocation to proceed (assuming access was granted)\n5. Call the AfterInvocationManager if configured, once the invocation has returned. If the invocation raised an exception, the AfterInvocationManager will not be invoked.\n\nconfiguration attributes指的是配置文件中的这些配置\n\n```xml\n<intercept-url pattern=\"/imageBridge/**\" access=\"permitAll\" /> \n<intercept-url pattern=\"/system/getStartInfo.htm\" access=\"permitAll\" /> \n<intercept-url pattern=\"/**/*.htm\" access=\"hasRole('ADMIN')\" />\n```\n\n### 核心组件\nAuthenticationManager顾名思义就是Authentication的管理器\n在spring security中的默认实现是ProviderManager这个类的作用就是串联起一系列的AuthenticationProvider,每个Provider都会对用户进行身份验证.如果成功就返回Authentication,失败的话就抛出异常\nAuthenticationProvider的定义:\n\n```java\npublic interface AuthenticationProvider {\n    Authentication authenticate(Authentication authentication)throws AuthenticationException;\n    boolean supports(Class<?> authentication);\n```\n\nUserDetailsService用于根据username获取UserDetails对象.很多默认的Provider都需要注入UserDetailsService,当然如果是自己实现的Provider就可以不需要实现UserDetailsService\n\n### 使用\n从上面的介绍中可以看出,spring security最重要的两大特性就是身份验证和访问控制.而且可以很灵活的单独使用访问控制.下面我们来介绍几种常见的使用方法.\n##### 1.自定义UserDetailsService\n\n这个是简化版本的UserDetailsService的实现.当然现实情况中可能会从数据库中加载user信息.\n这里使用的是默认的DaoAuthenticationProvider\n\n```java\npublic class MyUserDetailsService implements UserDetailsService {\n\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        List<GrantedAuthority> grantedAuthorities = new ArrayList<GrantedAuthority>();\n        grantedAuthorities.add(new SimpleGrantedAuthority(\"ROLE_GUEST\"));\n\n        // 如果用户为admin,则分配两个权限\n        if (\"admin\".equals(username)) {\n            grantedAuthorities.add(new SimpleGrantedAuthority(\"ROLE_ADMIN\"));\n        }\n        User user = new User(username, \"password\", true, true, true, true, grantedAuthorities);\n        return user;\n    }\n\n}\n```\nspring security的配置\n\n```xml\n<http>\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    <form-login />\n    <logout />\n</http>\n\n<authentication-manager>\n    <authentication-provider user-service-ref=\"myUserDetailsService\">\n    </authentication-provider>\n</authentication-manager>\n\n<b:bean id=\"myUserDetailsService\" class=\"name.chengchao.springsecurity.framework.MyUserDetailsService\"></b:bean>\n```\n\n##### 2.自定义Provider\n\n```java\npublic class MyAuthenticationProvider implements AuthenticationProvider {\n\n    private static Logger logger = LoggerFactory.getLogger(MyAuthenticationProvider.class);\n\n    public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n        String username = authentication.getName();\n        String password = authentication.getCredentials().toString();\n        if (!\"password\".equals(password)) {\n            throw new BadCredentialsException(\"password error,username:\" + username);\n        }\n        logger.info(\"username:{},login!\", username);\n        List<GrantedAuthority> grantedAuths = new ArrayList<GrantedAuthority>();\n        grantedAuths.add(new SimpleGrantedAuthority(\"ROLE_GUEST\"));\n        if (\"admin\".equals(username)) {\n            grantedAuths.add(new SimpleGrantedAuthority(\"ROLE_ADMIN\"));\n        }\n        return new UsernamePasswordAuthenticationToken(username, password, grantedAuths);\n    }\n\n    public boolean supports(Class<?> authentication) {\n        return authentication.equals(UsernamePasswordAuthenticationToken.class);\n    }\n\n}\n```\nspring security的配置\n\n```xml\n<http>\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    <form-login />\n    <logout />\n</http>\n\n<authentication-manager>\n    <authentication-provider ref=\"myAuthenticationProvider\">\n    </authentication-provider>\n</authentication-manager>\n\n<b:bean id=\"myAuthenticationProvider\" class=\"name.chengchao.springsecurity.framework.MyAuthenticationProvider\"></b:bean>\n```\n\n这样就不需要再用到userdetailsService\n\n\n##### 3.自定义Filter\n记得前面说过,spring只关心在AbstractSecurityInterceptor之前,contextHolder中有Authentication信息就行了,至于怎么放进去的是不关心的.  \n有很多时候,我们的系统需要和已有的统一登录(单点登录)系统对接.这就需要自定义一个filter来完成这个对接.\n\n```java\npublic class MySecurityFilter extends GenericFilterBean {\n\n    public Logger logger = LoggerFactory.getLogger(MySecurityFilter.class);\n\n    @Override\n    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException,\n                                                                                      ServletException {\n\n        HttpServletRequest request = (HttpServletRequest) req;\n        HttpServletResponse response = (HttpServletResponse) resp;\n\n        // 这里的user一般来自于统一登录系统\n        User user = new User(\"admin\");\n        // 再从数据库或者ACL系统查询该用户拥有的权限\n\n        logger.info(\"welcome,{}\", user.getName());\n\n        List<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();\n        authorities.add(new SimpleGrantedAuthority(\"ROLE_GUEST\"));\n        authorities.add(new SimpleGrantedAuthority(\"ROLE_ADMIN\"));\n        Authentication authentication = new UsernamePasswordAuthenticationToken(user.getName(), user.getName(),\n                                                                                authorities);\n        SecurityContextHolder.getContext().setAuthentication(authentication);\n        chain.doFilter(request, response);\n    }\n\n    class User {\n\n        private String name;\n\n        public User(String name){\n            super();\n            this.name = name;\n        }\n\n        public String getName() {\n            return name;\n        }\n\n    }\n\n}\n```\nspring security的配置\n\n```xml\n<http entry-point-ref=\"myAuthenticationEntryPoint\">\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    <!-- <form-login /> -->\n    <custom-filter ref=\"mySecurityFilter\" before=\"FILTER_SECURITY_INTERCEPTOR\" />\n    <logout />\n</http>\n\n<!-- 自定义的filter -->\n<b:bean id=\"mySecurityFilter\"\n    class=\"name.chengchao.springsecurity.framework.MySecurityFilter\"></b:bean>\n\n<!-- 定义一个空的entryPoint -->\n<b:bean id=\"myAuthenticationEntryPoint\"\n    class=\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"></b:bean>\n\n<authentication-manager></authentication-manager>\n\n```\n\n至此3中比较常见的用法都已经介绍完毕.在自定义的filter中会对每个请求都会做用户信息的查询.这里可以使用cache提高性能.在集群环境中,可以把用户信息放入用户浏览器的cookie中.用来保证不同机器之间的访问只需要登录一次.最后介绍一下权限的动态校验.因为以上举的例子都是静态化的配置.但在真实项目中对权限配置的需求往往是需要动态的(数据库).下面就来介绍一下如何在spring security中使用动态化的配置.  \n\n在开始之前,先要了解一下org.springframework.security.access.AccessDecisionManager.这个接口用来访问控制.\n\n```java\n/**\n     * Resolves an access control decision for the passed parameters.\n     *\n     * @param authentication the caller invoking the method (not null)\n     * @param object the secured object being called\n     * @param configAttributes the configuration attributes associated with the secured\n     * object being invoked\n     *\n     * @throws AccessDeniedException if access is denied as the authentication does not\n     * hold a required authority or ACL privilege\n     * @throws InsufficientAuthenticationException if access is denied as the\n     * authentication does not provide a sufficient level of trust\n     */\n    void decide(Authentication authentication, Object object,\n            Collection<ConfigAttribute> configAttributes) throws AccessDeniedException,\n            InsufficientAuthenticationException;\n```\n\n这个方法有三个参数:\n\n- Authentication:是谁,以及有什么角色\n- object:要访问的资源\n- configAttributes:访问控制策略的配置,如果在数据库中,这个参数可以忽略\n\n在来看看AbstractAccessDecisionManager有三个实现:\n\n- AffirmativeBased: 只要有一个同意就行\n- ConsensusBased: 少数服从多数\n- UnanimousBased: 全体一致同意\n\n可以根据自己的需要进行选择.下面的例子比较简单,用的是ConsensusBased\n\n```java\npublic class MyVoter implements AccessDecisionVoter<FilterInvocation> {\n\n    @Override\n    public int vote(Authentication authentication, FilterInvocation fi, Collection<ConfigAttribute> attributes) {\n        // FilterInvocation: URL: /admin.do 表示请求的资源\n        // Authentication: 表示用户以及他拥有的权限\n        // 根据数据库中的配置来决定\n        // 可以参考org.springframework.security.web.access.expression.WebExpressionVoter\n        return ACCESS_GRANTED;\n    }\n\n    @Override\n    public boolean supports(ConfigAttribute attribute) {\n        return true;\n    }\n\n    @Override\n    public boolean supports(Class<?> clazz) {\n        return true;\n    }\n\n}\n```\n\n\nspring security的配置\n\n```xml\n<http entry-point-ref=\"myAuthenticationEntryPoint\"\n    access-decision-manager-ref=\"accessDecisionManager\">\n    <!-- 从数据库读取\n    <intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" />\n    <intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" />\n    -->\n    <custom-filter ref=\"mySecurityFilter\" before=\"FILTER_SECURITY_INTERCEPTOR\" />\n    <logout />\n</http>\n\n<!-- 自定义的filter -->\n<b:bean id=\"mySecurityFilter\"\n    class=\"name.chengchao.springsecurity.framework.MySecurityFilter\"></b:bean>\n\n<!-- 定义一个空的entryPoint -->\n<b:bean id=\"myAuthenticationEntryPoint\"\n    class=\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"></b:bean>\n\n<authentication-manager></authentication-manager>\n\n\n<b:bean id=\"myVoter\" class=\"name.chengchao.springsecurity.framework.MyVoter\">\n</b:bean>\n\n<b:bean id=\"accessDecisionManager\"\n    class=\"org.springframework.security.access.vote.ConsensusBased\">\n    <b:constructor-arg ref=\"myVoter\"></b:constructor-arg>\n</b:bean>\n```\n","slug":"2016-05-04-spring-security","published":1,"date":"2016-05-04T14:48:33.000Z","updated":"2016-05-04T14:48:33.000Z","_id":"cinswj50k0000pdpyswx3cpcb","comments":1,"photos":[],"link":"","content":"<h1 id=\"spring-security\"><a href=\"#spring-security\" class=\"headerlink\" title=\"spring security\"></a>spring security</h1><h3 id=\"背景知识\"><a href=\"#背景知识\" class=\"headerlink\" title=\"背景知识\"></a>背景知识</h3><p>什么是spring security.官方解释:</p>\n<blockquote>\n<p>Spring Security provides comprehensive security services for Java EE-based enterprise software applications.   </p>\n</blockquote>\n<p>简单的说就是给应用提供安全服务的.那安全服务要解决哪里问题呢?<br>我认为主要要解决这两个问题:</p>\n<ul>\n<li>你是谁? (authentication,身份验证)</li>\n<li>你能干什么? (authorization,访问控制)</li>\n</ul>\n<p>对应到spring security中两个重要的概念<code>authentication</code>和<code>authorization</code></p>\n<h3 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><p>在一个使用spring框架的web应用中增加spring security的最简功能是非常之简单的.<br>第一步:在pom.xml中增加相应的依赖,这里以4.0.3为例.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.security<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-security-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.security<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-security-config<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第二步:在web.xml中配置filter,需要注意的是这个配置中的<code>springSecurityFilterChain</code>这个名称是不能随意自定义的,后面我们会再解释原因.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>springSecurityFilterChain<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>springSecurityFilterChain<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第三步:编写一个最简单的security配置,并import到已有的spring配置文件中.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/security\"</span></span><br><span class=\"line\">    <span class=\"attr\">xmlns:b</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span><br><span class=\"line\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class=\"line\">                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('USER')\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">form-login</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">user-service</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">user</span> <span class=\"attr\">name</span>=<span class=\"string\">\"admin\"</span> <span class=\"attr\">password</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">authorities</span>=<span class=\"string\">\"ROLE_USER\"</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">user-service</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">b:beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>经过这三步配置,最简单的spring security的集成已经完成了.现在可以访问你的应用试试.用户名:admin,密码:passowrd</p>\n<h3 id=\"初窥\"><a href=\"#初窥\" class=\"headerlink\" title=\"初窥\"></a>初窥</h3><p>那spring security又是怎么工作的呢?<br>这一切都得从web.xml的filter配置说起.可以spring security配置的filter是<code>org.springframework.web.filter.DelegatingFilterProxy</code>这是什么东东啊?看看这个类的javadoc解释就能明白:</p>\n<blockquote>\n<p>Proxy for a standard Servlet Filter, delegating to a Spring-managed bean that implements the Filter interface. </p>\n</blockquote>\n<p>这就是一个简单的代理类,代理spring container中实现了servlet filter的类,那如果很多实现了filter类该怎么找到想要的那个呢?通过<code>&lt;filter-name&gt;</code>中定义的名称.所以上面的web.xml配置中我提到了这个名称不能随意修改.而真正的spring security使用的filter是<code>org.springframework.security.filterChainProxy</code>.知道了入口就好办了,我们再接着分析这个filter chain中有哪些核心的filter.</p>\n<h3 id=\"核心对象\"><a href=\"#核心对象\" class=\"headerlink\" title=\"核心对象\"></a>核心对象</h3><p>SecurityContextHolder是spring security中最基本的对象,用于存储当前用户的所有安全相关的信息.默认使用ThreadLocal,也可以用<code>SecurityContextHolder</code>修改策略.大部分情况下是不需要修改的.这个类最常用的功能就是获取当前用户的信息,以下是官方提供的例子:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (principal <span class=\"keyword\">instanceof</span> UserDetails) &#123;</span><br><span class=\"line\">  String username = ((UserDetails)principal).getUsername();</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  String username = principal.toString();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>org.springframework.security.core.Authentication这个接口类也比较重要,里面存放了用户名,密码,以及用户拥有的权限列表.下面是官方的解释:</p>\n<ul>\n<li>SecurityContextHolder, to provide access to the SecurityContext.</li>\n<li>SecurityContext, to hold the Authentication and possibly request-specific security information.</li>\n<li>Authentication, to represent the principal in a Spring Security-specific manner.</li>\n<li>GrantedAuthority, to reflect the application-wide permissions granted to a principal.</li>\n<li>UserDetails, to provide the necessary information to build an Authentication object from your application’s DAOs or other source of security data.</li>\n<li>UserDetailsService, to create a UserDetails when passed in a String-based username (or certificate ID or the like).</li>\n</ul>\n<h3 id=\"身份验证-Authentication\"><a href=\"#身份验证-Authentication\" class=\"headerlink\" title=\"身份验证(Authentication)\"></a>身份验证(Authentication)</h3><p>一般web应用的步骤都是:</p>\n<ol>\n<li>用传入的用户名和密码生成UsernamePasswordAuthenticationToken</li>\n<li>传入AuthenticationManager的实现类做校验</li>\n<li>如果验证通过返回一个完整的Authentication</li>\n<li>用SecurityContextHolder.getContext().setAuthentication()方法存入context</li>\n</ol>\n<p>简化版的代码实现:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.Authentication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AuthenticationExample</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> AuthenticationManager am = <span class=\"keyword\">new</span> SampleAuthenticationManager();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//正确的用户名:admin,密码:1234</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        BufferedReader in = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(System.in));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Please enter your username:\"</span>);</span><br><span class=\"line\">            String name = in.readLine();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Please enter your password:\"</span>);</span><br><span class=\"line\">            String password = in.readLine();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Authentication request = <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(name, password);</span><br><span class=\"line\">                Authentication result = am.authenticate(request);</span><br><span class=\"line\">                SecurityContextHolder.getContext().setAuthentication(result);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (AuthenticationException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">\"Authentication failed: \"</span> + e.getMessage());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Successfully authenticated. Security context contains: \"</span></span><br><span class=\"line\">                           + SecurityContextHolder.getContext().getAuthentication());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SampleAuthenticationManager</span> <span class=\"keyword\">implements</span> <span class=\"title\">AuthenticationManager</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> List&lt;GrantedAuthority&gt; AUTHORITIES = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        AUTHORITIES.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_USER\"</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Authentication <span class=\"title\">authenticate</span><span class=\"params\">(Authentication auth)</span> <span class=\"keyword\">throws</span> AuthenticationException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"admin\"</span>.equals(auth.getName()) &amp;&amp; <span class=\"string\">\"1234\"</span>.equals(auth.getCredentials())) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(auth.getName(), auth.getCredentials(), AUTHORITIES);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BadCredentialsException(<span class=\"string\">\"Bad Credentials\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>还可以直接向context中塞入Authentication</p>\n<blockquote>\n<p>In fact, Spring Security doesn’t mind how you put the Authentication object inside the SecurityContextHolder. The only critical requirement is that the SecurityContextHolder contains an Authentication which represents a principal before the <code>AbstractSecurityInterceptor</code> (which we’ll see more about later) needs to authorize a user operation.</p>\n</blockquote>\n<h3 id=\"访问控制-Authorization\"><a href=\"#访问控制-Authorization\" class=\"headerlink\" title=\"访问控制(Authorization)\"></a>访问控制(Authorization)</h3><p>AccessDecisionManager来决定一个用户(Authentication)能否访问特定的资源(web应用中一般是url)</p>\n<p>AbstractSecurityInterceptor的鉴权步骤:</p>\n<ol>\n<li>Look up the “configuration attributes” associated with the present request</li>\n<li>Submitting the secure object, current Authentication and configuration attributes to the AccessDecisionManager for an authorization decision</li>\n<li>Optionally change the Authentication under which the invocation takes place</li>\n<li>Allow the secure object invocation to proceed (assuming access was granted)</li>\n<li>Call the AfterInvocationManager if configured, once the invocation has returned. If the invocation raised an exception, the AfterInvocationManager will not be invoked.</li>\n</ol>\n<p>configuration attributes指的是配置文件中的这些配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/imageBridge/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"permitAll\"</span> /&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/system/getStartInfo.htm\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"permitAll\"</span> /&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**/*.htm\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"核心组件\"><a href=\"#核心组件\" class=\"headerlink\" title=\"核心组件\"></a>核心组件</h3><p>AuthenticationManager顾名思义就是Authentication的管理器<br>在spring security中的默认实现是ProviderManager这个类的作用就是串联起一系列的AuthenticationProvider,每个Provider都会对用户进行身份验证.如果成功就返回Authentication,失败的话就抛出异常<br>AuthenticationProvider的定义:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AuthenticationProvider</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">Authentication <span class=\"title\">authenticate</span><span class=\"params\">(Authentication authentication)</span><span class=\"keyword\">throws</span> AuthenticationException</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Class&lt;?&gt; authentication)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>UserDetailsService用于根据username获取UserDetails对象.很多默认的Provider都需要注入UserDetailsService,当然如果是自己实现的Provider就可以不需要实现UserDetailsService</p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>从上面的介绍中可以看出,spring security最重要的两大特性就是身份验证和访问控制.而且可以很灵活的单独使用访问控制.下面我们来介绍几种常见的使用方法.</p>\n<h5 id=\"1-自定义UserDetailsService\"><a href=\"#1-自定义UserDetailsService\" class=\"headerlink\" title=\"1.自定义UserDetailsService\"></a>1.自定义UserDetailsService</h5><p>这个是简化版本的UserDetailsService的实现.当然现实情况中可能会从数据库中加载user信息.<br>这里使用的是默认的DaoAuthenticationProvider</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyUserDetailsService</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserDetailsService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserDetails <span class=\"title\">loadUserByUsername</span><span class=\"params\">(String username)</span> <span class=\"keyword\">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class=\"line\">        List&lt;GrantedAuthority&gt; grantedAuthorities = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\">        grantedAuthorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_GUEST\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 如果用户为admin,则分配两个权限</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"admin\"</span>.equals(username)) &#123;</span><br><span class=\"line\">            grantedAuthorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_ADMIN\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User(username, <span class=\"string\">\"password\"</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, grantedAuthorities);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/admin.do\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasAnyRole('GUEST','ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form-login</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">authentication-provider</span> <span class=\"attr\">user-service-ref</span>=<span class=\"string\">\"myUserDetailsService\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myUserDetailsService\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyUserDetailsService\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"2-自定义Provider\"><a href=\"#2-自定义Provider\" class=\"headerlink\" title=\"2.自定义Provider\"></a>2.自定义Provider</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyAuthenticationProvider</span> <span class=\"keyword\">implements</span> <span class=\"title\">AuthenticationProvider</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Logger logger = LoggerFactory.getLogger(MyAuthenticationProvider.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Authentication <span class=\"title\">authenticate</span><span class=\"params\">(Authentication authentication)</span> <span class=\"keyword\">throws</span> AuthenticationException </span>&#123;</span><br><span class=\"line\">        String username = authentication.getName();</span><br><span class=\"line\">        String password = authentication.getCredentials().toString();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"string\">\"password\"</span>.equals(password)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BadCredentialsException(<span class=\"string\">\"password error,username:\"</span> + username);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"username:&#123;&#125;,login!\"</span>, username);</span><br><span class=\"line\">        List&lt;GrantedAuthority&gt; grantedAuths = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\">        grantedAuths.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_GUEST\"</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"admin\"</span>.equals(username)) &#123;</span><br><span class=\"line\">            grantedAuths.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_ADMIN\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(username, password, grantedAuths);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Class&lt;?&gt; authentication)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authentication.equals(UsernamePasswordAuthenticationToken.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/admin.do\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasAnyRole('GUEST','ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form-login</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">authentication-provider</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"myAuthenticationProvider\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myAuthenticationProvider\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyAuthenticationProvider\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样就不需要再用到userdetailsService</p>\n<h5 id=\"3-自定义Filter\"><a href=\"#3-自定义Filter\" class=\"headerlink\" title=\"3.自定义Filter\"></a>3.自定义Filter</h5><p>记得前面说过,spring只关心在AbstractSecurityInterceptor之前,contextHolder中有Authentication信息就行了,至于怎么放进去的是不关心的.<br>有很多时候,我们的系统需要和已有的统一登录(单点登录)系统对接.这就需要自定义一个filter来完成这个对接.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySecurityFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">GenericFilterBean</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Logger logger = LoggerFactory.getLogger(MySecurityFilter.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilter</span><span class=\"params\">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class=\"keyword\">throws</span> IOException,</span><br><span class=\"line\">                                                                                      ServletException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class=\"line\">        HttpServletResponse response = (HttpServletResponse) resp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 这里的user一般来自于统一登录系统</span></span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User(<span class=\"string\">\"admin\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 再从数据库或者ACL系统查询该用户拥有的权限</span></span><br><span class=\"line\"></span><br><span class=\"line\">        logger.info(<span class=\"string\">\"welcome,&#123;&#125;\"</span>, user.getName());</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;GrantedAuthority&gt; authorities = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\">        authorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_GUEST\"</span>));</span><br><span class=\"line\">        authorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_ADMIN\"</span>));</span><br><span class=\"line\">        Authentication authentication = <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(user.getName(), user.getName(),</span><br><span class=\"line\">                                                                                authorities);</span><br><span class=\"line\">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class=\"line\">        chain.doFilter(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">User</span><span class=\"params\">(String name)</span></span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>();</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span> <span class=\"attr\">entry-point-ref</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/admin.do\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasAnyRole('GUEST','ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;form-login /&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">custom-filter</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"mySecurityFilter\"</span> <span class=\"attr\">before</span>=<span class=\"string\">\"FILTER_SECURITY_INTERCEPTOR\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 自定义的filter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mySecurityFilter\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MySecurityFilter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 定义一个空的entryPoint --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>至此3中比较常见的用法都已经介绍完毕.在自定义的filter中会对每个请求都会做用户信息的查询.这里可以使用cache提高性能.在集群环境中,可以把用户信息放入用户浏览器的cookie中.用来保证不同机器之间的访问只需要登录一次.最后介绍一下权限的动态校验.因为以上举的例子都是静态化的配置.但在真实项目中对权限配置的需求往往是需要动态的(数据库).下面就来介绍一下如何在spring security中使用动态化的配置.  </p>\n<p>在开始之前,先要了解一下org.springframework.security.access.AccessDecisionManager.这个接口用来访问控制.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\">     * Resolves an access control decision for the passed parameters.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> authentication the caller invoking the method (not null)</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> object the secured object being called</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> configAttributes the configuration attributes associated with the secured</span><br><span class=\"line\">     * object being invoked</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> AccessDeniedException if access is denied as the authentication does not</span><br><span class=\"line\">     * hold a required authority or ACL privilege</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> InsufficientAuthenticationException if access is denied as the</span><br><span class=\"line\">     * authentication does not provide a sufficient level of trust</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">decide</span><span class=\"params\">(Authentication authentication, Object object,</span><br><span class=\"line\">            Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class=\"keyword\">throws</span> AccessDeniedException,</span><br><span class=\"line\">            InsufficientAuthenticationException</span>;</span><br></pre></td></tr></table></figure>\n<p>这个方法有三个参数:</p>\n<ul>\n<li>Authentication:是谁,以及有什么角色</li>\n<li>object:要访问的资源</li>\n<li>configAttributes:访问控制策略的配置,如果在数据库中,这个参数可以忽略</li>\n</ul>\n<p>在来看看AbstractAccessDecisionManager有三个实现:</p>\n<ul>\n<li>AffirmativeBased: 只要有一个同意就行</li>\n<li>ConsensusBased: 少数服从多数</li>\n<li>UnanimousBased: 全体一致同意</li>\n</ul>\n<p>可以根据自己的需要进行选择.下面的例子比较简单,用的是ConsensusBased</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyVoter</span> <span class=\"keyword\">implements</span> <span class=\"title\">AccessDecisionVoter</span>&lt;<span class=\"title\">FilterInvocation</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">vote</span><span class=\"params\">(Authentication authentication, FilterInvocation fi, Collection&lt;ConfigAttribute&gt; attributes)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// FilterInvocation: URL: /admin.do 表示请求的资源</span></span><br><span class=\"line\">        <span class=\"comment\">// Authentication: 表示用户以及他拥有的权限</span></span><br><span class=\"line\">        <span class=\"comment\">// 根据数据库中的配置来决定</span></span><br><span class=\"line\">        <span class=\"comment\">// 可以参考org.springframework.security.web.access.expression.WebExpressionVoter</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ACCESS_GRANTED;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(ConfigAttribute attribute)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span> <span class=\"attr\">entry-point-ref</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span></span><br><span class=\"line\">    <span class=\"attr\">access-decision-manager-ref</span>=<span class=\"string\">\"accessDecisionManager\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 从数据库读取</span><br><span class=\"line\">    &lt;intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" /&gt;</span><br><span class=\"line\">    &lt;intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" /&gt;</span><br><span class=\"line\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">custom-filter</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"mySecurityFilter\"</span> <span class=\"attr\">before</span>=<span class=\"string\">\"FILTER_SECURITY_INTERCEPTOR\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 自定义的filter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mySecurityFilter\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MySecurityFilter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 定义一个空的entryPoint --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myVoter\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyVoter\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"accessDecisionManager\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.security.access.vote.ConsensusBased\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">b:constructor-arg</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"myVoter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:constructor-arg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h1 id=\"spring-security\"><a href=\"#spring-security\" class=\"headerlink\" title=\"spring security\"></a>spring security</h1><h3 id=\"背景知识\"><a href=\"#背景知识\" class=\"headerlink\" title=\"背景知识\"></a>背景知识</h3><p>什么是spring security.官方解释:</p>\n<blockquote>\n<p>Spring Security provides comprehensive security services for Java EE-based enterprise software applications.   </p>\n</blockquote>\n<p>简单的说就是给应用提供安全服务的.那安全服务要解决哪里问题呢?<br>我认为主要要解决这两个问题:</p>\n<ul>\n<li>你是谁? (authentication,身份验证)</li>\n<li>你能干什么? (authorization,访问控制)</li>\n</ul>\n<p>对应到spring security中两个重要的概念<code>authentication</code>和<code>authorization</code></p>\n<h3 id=\"Hello-World\"><a href=\"#Hello-World\" class=\"headerlink\" title=\"Hello World\"></a>Hello World</h3><p>在一个使用spring框架的web应用中增加spring security的最简功能是非常之简单的.<br>第一步:在pom.xml中增加相应的依赖,这里以4.0.3为例.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.security<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-security-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.security<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-security-config<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第二步:在web.xml中配置filter,需要注意的是这个配置中的<code>springSecurityFilterChain</code>这个名称是不能随意自定义的,后面我们会再解释原因.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>springSecurityFilterChain<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>springSecurityFilterChain<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第三步:编写一个最简单的security配置,并import到已有的spring配置文件中.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/security\"</span></span><br><span class=\"line\">    <span class=\"attr\">xmlns:b</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span><br><span class=\"line\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class=\"line\">                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('USER')\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">form-login</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">user-service</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">user</span> <span class=\"attr\">name</span>=<span class=\"string\">\"admin\"</span> <span class=\"attr\">password</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">authorities</span>=<span class=\"string\">\"ROLE_USER\"</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">user-service</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">b:beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>经过这三步配置,最简单的spring security的集成已经完成了.现在可以访问你的应用试试.用户名:admin,密码:passowrd</p>\n<h3 id=\"初窥\"><a href=\"#初窥\" class=\"headerlink\" title=\"初窥\"></a>初窥</h3><p>那spring security又是怎么工作的呢?<br>这一切都得从web.xml的filter配置说起.可以spring security配置的filter是<code>org.springframework.web.filter.DelegatingFilterProxy</code>这是什么东东啊?看看这个类的javadoc解释就能明白:</p>\n<blockquote>\n<p>Proxy for a standard Servlet Filter, delegating to a Spring-managed bean that implements the Filter interface. </p>\n</blockquote>\n<p>这就是一个简单的代理类,代理spring container中实现了servlet filter的类,那如果很多实现了filter类该怎么找到想要的那个呢?通过<code>&lt;filter-name&gt;</code>中定义的名称.所以上面的web.xml配置中我提到了这个名称不能随意修改.而真正的spring security使用的filter是<code>org.springframework.security.filterChainProxy</code>.知道了入口就好办了,我们再接着分析这个filter chain中有哪些核心的filter.</p>\n<h3 id=\"核心对象\"><a href=\"#核心对象\" class=\"headerlink\" title=\"核心对象\"></a>核心对象</h3><p>SecurityContextHolder是spring security中最基本的对象,用于存储当前用户的所有安全相关的信息.默认使用ThreadLocal,也可以用<code>SecurityContextHolder</code>修改策略.大部分情况下是不需要修改的.这个类最常用的功能就是获取当前用户的信息,以下是官方提供的例子:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (principal <span class=\"keyword\">instanceof</span> UserDetails) &#123;</span><br><span class=\"line\">  String username = ((UserDetails)principal).getUsername();</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  String username = principal.toString();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>org.springframework.security.core.Authentication这个接口类也比较重要,里面存放了用户名,密码,以及用户拥有的权限列表.下面是官方的解释:</p>\n<ul>\n<li>SecurityContextHolder, to provide access to the SecurityContext.</li>\n<li>SecurityContext, to hold the Authentication and possibly request-specific security information.</li>\n<li>Authentication, to represent the principal in a Spring Security-specific manner.</li>\n<li>GrantedAuthority, to reflect the application-wide permissions granted to a principal.</li>\n<li>UserDetails, to provide the necessary information to build an Authentication object from your application’s DAOs or other source of security data.</li>\n<li>UserDetailsService, to create a UserDetails when passed in a String-based username (or certificate ID or the like).</li>\n</ul>\n<h3 id=\"身份验证-Authentication\"><a href=\"#身份验证-Authentication\" class=\"headerlink\" title=\"身份验证(Authentication)\"></a>身份验证(Authentication)</h3><p>一般web应用的步骤都是:</p>\n<ol>\n<li>用传入的用户名和密码生成UsernamePasswordAuthenticationToken</li>\n<li>传入AuthenticationManager的实现类做校验</li>\n<li>如果验证通过返回一个完整的Authentication</li>\n<li>用SecurityContextHolder.getContext().setAuthentication()方法存入context</li>\n</ol>\n<p>简化版的代码实现:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.Authentication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AuthenticationExample</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> AuthenticationManager am = <span class=\"keyword\">new</span> SampleAuthenticationManager();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//正确的用户名:admin,密码:1234</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        BufferedReader in = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(System.in));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Please enter your username:\"</span>);</span><br><span class=\"line\">            String name = in.readLine();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Please enter your password:\"</span>);</span><br><span class=\"line\">            String password = in.readLine();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Authentication request = <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(name, password);</span><br><span class=\"line\">                Authentication result = am.authenticate(request);</span><br><span class=\"line\">                SecurityContextHolder.getContext().setAuthentication(result);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (AuthenticationException e) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">\"Authentication failed: \"</span> + e.getMessage());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Successfully authenticated. Security context contains: \"</span></span><br><span class=\"line\">                           + SecurityContextHolder.getContext().getAuthentication());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SampleAuthenticationManager</span> <span class=\"keyword\">implements</span> <span class=\"title\">AuthenticationManager</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> List&lt;GrantedAuthority&gt; AUTHORITIES = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        AUTHORITIES.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_USER\"</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Authentication <span class=\"title\">authenticate</span><span class=\"params\">(Authentication auth)</span> <span class=\"keyword\">throws</span> AuthenticationException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"admin\"</span>.equals(auth.getName()) &amp;&amp; <span class=\"string\">\"1234\"</span>.equals(auth.getCredentials())) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(auth.getName(), auth.getCredentials(), AUTHORITIES);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BadCredentialsException(<span class=\"string\">\"Bad Credentials\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>还可以直接向context中塞入Authentication</p>\n<blockquote>\n<p>In fact, Spring Security doesn’t mind how you put the Authentication object inside the SecurityContextHolder. The only critical requirement is that the SecurityContextHolder contains an Authentication which represents a principal before the <code>AbstractSecurityInterceptor</code> (which we’ll see more about later) needs to authorize a user operation.</p>\n</blockquote>\n<h3 id=\"访问控制-Authorization\"><a href=\"#访问控制-Authorization\" class=\"headerlink\" title=\"访问控制(Authorization)\"></a>访问控制(Authorization)</h3><p>AccessDecisionManager来决定一个用户(Authentication)能否访问特定的资源(web应用中一般是url)</p>\n<p>AbstractSecurityInterceptor的鉴权步骤:</p>\n<ol>\n<li>Look up the “configuration attributes” associated with the present request</li>\n<li>Submitting the secure object, current Authentication and configuration attributes to the AccessDecisionManager for an authorization decision</li>\n<li>Optionally change the Authentication under which the invocation takes place</li>\n<li>Allow the secure object invocation to proceed (assuming access was granted)</li>\n<li>Call the AfterInvocationManager if configured, once the invocation has returned. If the invocation raised an exception, the AfterInvocationManager will not be invoked.</li>\n</ol>\n<p>configuration attributes指的是配置文件中的这些配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/imageBridge/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"permitAll\"</span> /&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/system/getStartInfo.htm\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"permitAll\"</span> /&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**/*.htm\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"核心组件\"><a href=\"#核心组件\" class=\"headerlink\" title=\"核心组件\"></a>核心组件</h3><p>AuthenticationManager顾名思义就是Authentication的管理器<br>在spring security中的默认实现是ProviderManager这个类的作用就是串联起一系列的AuthenticationProvider,每个Provider都会对用户进行身份验证.如果成功就返回Authentication,失败的话就抛出异常<br>AuthenticationProvider的定义:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AuthenticationProvider</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">Authentication <span class=\"title\">authenticate</span><span class=\"params\">(Authentication authentication)</span><span class=\"keyword\">throws</span> AuthenticationException</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Class&lt;?&gt; authentication)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>UserDetailsService用于根据username获取UserDetails对象.很多默认的Provider都需要注入UserDetailsService,当然如果是自己实现的Provider就可以不需要实现UserDetailsService</p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>从上面的介绍中可以看出,spring security最重要的两大特性就是身份验证和访问控制.而且可以很灵活的单独使用访问控制.下面我们来介绍几种常见的使用方法.</p>\n<h5 id=\"1-自定义UserDetailsService\"><a href=\"#1-自定义UserDetailsService\" class=\"headerlink\" title=\"1.自定义UserDetailsService\"></a>1.自定义UserDetailsService</h5><p>这个是简化版本的UserDetailsService的实现.当然现实情况中可能会从数据库中加载user信息.<br>这里使用的是默认的DaoAuthenticationProvider</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyUserDetailsService</span> <span class=\"keyword\">implements</span> <span class=\"title\">UserDetailsService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> UserDetails <span class=\"title\">loadUserByUsername</span><span class=\"params\">(String username)</span> <span class=\"keyword\">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class=\"line\">        List&lt;GrantedAuthority&gt; grantedAuthorities = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\">        grantedAuthorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_GUEST\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 如果用户为admin,则分配两个权限</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"admin\"</span>.equals(username)) &#123;</span><br><span class=\"line\">            grantedAuthorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_ADMIN\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User(username, <span class=\"string\">\"password\"</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, grantedAuthorities);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/admin.do\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasAnyRole('GUEST','ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form-login</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">authentication-provider</span> <span class=\"attr\">user-service-ref</span>=<span class=\"string\">\"myUserDetailsService\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myUserDetailsService\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyUserDetailsService\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"2-自定义Provider\"><a href=\"#2-自定义Provider\" class=\"headerlink\" title=\"2.自定义Provider\"></a>2.自定义Provider</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyAuthenticationProvider</span> <span class=\"keyword\">implements</span> <span class=\"title\">AuthenticationProvider</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Logger logger = LoggerFactory.getLogger(MyAuthenticationProvider.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Authentication <span class=\"title\">authenticate</span><span class=\"params\">(Authentication authentication)</span> <span class=\"keyword\">throws</span> AuthenticationException </span>&#123;</span><br><span class=\"line\">        String username = authentication.getName();</span><br><span class=\"line\">        String password = authentication.getCredentials().toString();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"string\">\"password\"</span>.equals(password)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> BadCredentialsException(<span class=\"string\">\"password error,username:\"</span> + username);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"username:&#123;&#125;,login!\"</span>, username);</span><br><span class=\"line\">        List&lt;GrantedAuthority&gt; grantedAuths = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\">        grantedAuths.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_GUEST\"</span>));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"admin\"</span>.equals(username)) &#123;</span><br><span class=\"line\">            grantedAuths.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_ADMIN\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(username, password, grantedAuths);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Class&lt;?&gt; authentication)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> authentication.equals(UsernamePasswordAuthenticationToken.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/admin.do\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasAnyRole('GUEST','ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">form-login</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">authentication-provider</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"myAuthenticationProvider\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">authentication-provider</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myAuthenticationProvider\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyAuthenticationProvider\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>这样就不需要再用到userdetailsService</p>\n<h5 id=\"3-自定义Filter\"><a href=\"#3-自定义Filter\" class=\"headerlink\" title=\"3.自定义Filter\"></a>3.自定义Filter</h5><p>记得前面说过,spring只关心在AbstractSecurityInterceptor之前,contextHolder中有Authentication信息就行了,至于怎么放进去的是不关心的.<br>有很多时候,我们的系统需要和已有的统一登录(单点登录)系统对接.这就需要自定义一个filter来完成这个对接.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MySecurityFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">GenericFilterBean</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Logger logger = LoggerFactory.getLogger(MySecurityFilter.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilter</span><span class=\"params\">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class=\"keyword\">throws</span> IOException,</span><br><span class=\"line\">                                                                                      ServletException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class=\"line\">        HttpServletResponse response = (HttpServletResponse) resp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 这里的user一般来自于统一登录系统</span></span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User(<span class=\"string\">\"admin\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 再从数据库或者ACL系统查询该用户拥有的权限</span></span><br><span class=\"line\"></span><br><span class=\"line\">        logger.info(<span class=\"string\">\"welcome,&#123;&#125;\"</span>, user.getName());</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;GrantedAuthority&gt; authorities = <span class=\"keyword\">new</span> ArrayList&lt;GrantedAuthority&gt;();</span><br><span class=\"line\">        authorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_GUEST\"</span>));</span><br><span class=\"line\">        authorities.add(<span class=\"keyword\">new</span> SimpleGrantedAuthority(<span class=\"string\">\"ROLE_ADMIN\"</span>));</span><br><span class=\"line\">        Authentication authentication = <span class=\"keyword\">new</span> UsernamePasswordAuthenticationToken(user.getName(), user.getName(),</span><br><span class=\"line\">                                                                                authorities);</span><br><span class=\"line\">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class=\"line\">        chain.doFilter(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">User</span><span class=\"params\">(String name)</span></span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>();</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span> <span class=\"attr\">entry-point-ref</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/admin.do\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasRole('ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intercept-url</span> <span class=\"attr\">pattern</span>=<span class=\"string\">\"/**\"</span> <span class=\"attr\">access</span>=<span class=\"string\">\"hasAnyRole('GUEST','ADMIN')\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;form-login /&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">custom-filter</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"mySecurityFilter\"</span> <span class=\"attr\">before</span>=<span class=\"string\">\"FILTER_SECURITY_INTERCEPTOR\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 自定义的filter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mySecurityFilter\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MySecurityFilter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 定义一个空的entryPoint --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>至此3中比较常见的用法都已经介绍完毕.在自定义的filter中会对每个请求都会做用户信息的查询.这里可以使用cache提高性能.在集群环境中,可以把用户信息放入用户浏览器的cookie中.用来保证不同机器之间的访问只需要登录一次.最后介绍一下权限的动态校验.因为以上举的例子都是静态化的配置.但在真实项目中对权限配置的需求往往是需要动态的(数据库).下面就来介绍一下如何在spring security中使用动态化的配置.  </p>\n<p>在开始之前,先要了解一下org.springframework.security.access.AccessDecisionManager.这个接口用来访问控制.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\">     * Resolves an access control decision for the passed parameters.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> authentication the caller invoking the method (not null)</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> object the secured object being called</span><br><span class=\"line\">     * <span class=\"doctag\">@param</span> configAttributes the configuration attributes associated with the secured</span><br><span class=\"line\">     * object being invoked</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> AccessDeniedException if access is denied as the authentication does not</span><br><span class=\"line\">     * hold a required authority or ACL privilege</span><br><span class=\"line\">     * <span class=\"doctag\">@throws</span> InsufficientAuthenticationException if access is denied as the</span><br><span class=\"line\">     * authentication does not provide a sufficient level of trust</span><br><span class=\"line\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">decide</span><span class=\"params\">(Authentication authentication, Object object,</span><br><span class=\"line\">            Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class=\"keyword\">throws</span> AccessDeniedException,</span><br><span class=\"line\">            InsufficientAuthenticationException</span>;</span><br></pre></td></tr></table></figure>\n<p>这个方法有三个参数:</p>\n<ul>\n<li>Authentication:是谁,以及有什么角色</li>\n<li>object:要访问的资源</li>\n<li>configAttributes:访问控制策略的配置,如果在数据库中,这个参数可以忽略</li>\n</ul>\n<p>在来看看AbstractAccessDecisionManager有三个实现:</p>\n<ul>\n<li>AffirmativeBased: 只要有一个同意就行</li>\n<li>ConsensusBased: 少数服从多数</li>\n<li>UnanimousBased: 全体一致同意</li>\n</ul>\n<p>可以根据自己的需要进行选择.下面的例子比较简单,用的是ConsensusBased</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyVoter</span> <span class=\"keyword\">implements</span> <span class=\"title\">AccessDecisionVoter</span>&lt;<span class=\"title\">FilterInvocation</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">vote</span><span class=\"params\">(Authentication authentication, FilterInvocation fi, Collection&lt;ConfigAttribute&gt; attributes)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// FilterInvocation: URL: /admin.do 表示请求的资源</span></span><br><span class=\"line\">        <span class=\"comment\">// Authentication: 表示用户以及他拥有的权限</span></span><br><span class=\"line\">        <span class=\"comment\">// 根据数据库中的配置来决定</span></span><br><span class=\"line\">        <span class=\"comment\">// 可以参考org.springframework.security.web.access.expression.WebExpressionVoter</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ACCESS_GRANTED;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(ConfigAttribute attribute)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>spring security的配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">http</span> <span class=\"attr\">entry-point-ref</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span></span><br><span class=\"line\">    <span class=\"attr\">access-decision-manager-ref</span>=<span class=\"string\">\"accessDecisionManager\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 从数据库读取</span><br><span class=\"line\">    &lt;intercept-url pattern=\"/admin.do\" access=\"hasRole('ADMIN')\" /&gt;</span><br><span class=\"line\">    &lt;intercept-url pattern=\"/**\" access=\"hasAnyRole('GUEST','ADMIN')\" /&gt;</span><br><span class=\"line\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">custom-filter</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"mySecurityFilter\"</span> <span class=\"attr\">before</span>=<span class=\"string\">\"FILTER_SECURITY_INTERCEPTOR\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logout</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">http</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 自定义的filter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mySecurityFilter\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MySecurityFilter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 定义一个空的entryPoint --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myAuthenticationEntryPoint\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyAuthenticationEntryPoint\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">authentication-manager</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">authentication-manager</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myVoter\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"name.chengchao.springsecurity.framework.MyVoter\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">b:bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"accessDecisionManager\"</span></span><br><span class=\"line\">    <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.security.access.vote.ConsensusBased\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">b:constructor-arg</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"myVoter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">b:constructor-arg</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">b:bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","slug":"hello-world","published":1,"date":"2016-05-04T13:26:31.000Z","updated":"2016-05-04T13:26:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cinswj50q0001pdpyjwg59udj","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"external\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"external\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"external\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"external\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"external\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"external\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"external\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"external\">Deployment</a></p>\n","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\">Deployment</a></p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cinswj50k0000pdpyswx3cpcb","tag_id":"cinswj50u0002pdpy8adaqzrv","_id":"cinswj50z0005pdpyb1nm7ehm"},{"post_id":"cinswj50k0000pdpyswx3cpcb","tag_id":"cinswj50x0003pdpy9fh9uhoh","_id":"cinswj50z0006pdpy9slsdh1j"},{"post_id":"cinswj50k0000pdpyswx3cpcb","tag_id":"cinswj50y0004pdpyxmhrmqif","_id":"cinswj50z0007pdpyue18cdaj"}],"Tag":[{"name":"java","_id":"cinswj50u0002pdpy8adaqzrv"},{"name":"tech","_id":"cinswj50x0003pdpy9fh9uhoh"},{"name":"spring","_id":"cinswj50y0004pdpyxmhrmqif"}]}}